---
title: "New_Bison_Impact_grassland"
output: html_document
date: "2025-08-01"
---

load packages.tidyverse is a collection of R packages (like dplyr, ggplot2, readr, etc.) designed for data science.
```{r}
library(tidyverse)
library(vegan)

```

load data
```{r}
veg_bison<- read.csv("../Data/knb-lter-knz/PVC021.csv")
veg_cattle <- read.csv("../Data/Cattle grazed watersheds/PBG011.csv") %>%
  relocate(Pid, .after = CoverClass)

```

Rename cattle-grazed dataset column names to match bison-grazed dataset

```{r}
names(veg_cattle) <- c("DataCode", "RecType", "RecYear", "RecMonth", "RecDay",
                       "WaterShed", "SoilType", "Transect", "Plot", "SpeCode",
                       "AB_genus", "AB_species", "CoverClass", "Pid", "Comments")
```

```{r}
names(veg_bison)
names(veg_cattle)
```
Combine both datasets into one
```{r}
vegetation <- rbind(veg_bison, veg_cattle)
```

Create plot_ID

```{r}
vegetation <- vegetation %>%
  mutate(
    #standardize transect IDs
    transect = case_match(
      Transect,
      "a" ~ "a",
      "A" ~ "a",
      "b" ~ "b",
      "B" ~ "b",
      "c" ~ "c",
      "C" ~ "c",
      "d" ~ "d",
      "D" ~ "d"),
    #create plot IDs
    plot_ID = paste0(WaterShed,
                     Plot,
                     transect,
                     SoilType,
                     RecYear,
                     RecMonth,
                     RecDay))
```

create species matrix

```{r}
vegetation <- vegetation %>%
  mutate(
    scientific_name = paste(AB_genus, AB_species),
    pctCover = case_when(
      CoverClass == 1 ~ mean(c(0, 1)),
      CoverClass == 2 ~ mean(c(2, 5)),
      CoverClass == 3 ~ mean(c(5, 25)),
      CoverClass == 4 ~ mean(c(25, 50)),
      CoverClass == 5 ~ mean(c(50, 75)),
      CoverClass == 6 ~ mean(c(75, 95)),
      CoverClass == 7 ~ mean(c(95, 100))
    ))
spp_matrix <- vegetation %>% 
  #remove duplicate row
  filter(!(plot_ID == "004b1dt2024816" &
           scientific_name == "teucri canad" &
           CoverClass == 1)) %>% 
  pivot_wider(id_cols = plot_ID,
              names_from = scientific_name,
              values_from = pctCover,
              values_fill = 0)
              #values_fn = mean)
#sum how many rows of spp matrix are 0
sum(rowSums(spp_matrix[ , -1], na.rm = TRUE) == 0)
  


```
# Remove rows where all species columns are 0 cause some plot_IDs have no pctCover value for all species
```{r}
  # spp_matrix <- spp_matrix[
  # rowSums(sapply(spp_matrix[, -1], as.numeric), na.rm = TRUE) > 0,
  # ]
  # #Confirm it's clean now. sum how many rows of spp matrix are 0
  # sum(rowSums(spp_matrix[, -1], na.rm = TRUE) == 0)
  
```


Create diversity index with year/watershed by leftjoin

```{r}
# Create lookup table
plot_info <- vegetation %>%
  select(plot_ID, WaterShed, RecYear) %>%
  distinct()
# Create diversity index with year/watershed
diversityIndex <- data.frame(
  plot_ID = spp_matrix[ ,1],
  richness = specnumber(spp_matrix[, -1]),
  simpson = diversity(spp_matrix[, -1], index = "simpson"),
  shannon = diversity(spp_matrix[, -1], index = "shannon")
) %>%
  left_join(plot_info, by = "plot_ID")
#sum how many rows of diversity index for richness, simpson and shannon are NA
sum((is.na(diversityIndex$richness) | diversityIndex$richness == 0) & (is.na(diversityIndex$simpson) | diversityIndex$simpson == 0) & (is.na(diversityIndex$shannon) | diversityIndex$shannon == 0))


```




